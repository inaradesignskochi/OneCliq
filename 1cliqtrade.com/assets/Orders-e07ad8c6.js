import{z as Ie,L as Te,E as w,y as Z,G as ae,ak as he,O as Pe,a as O,P as $,m as L,l as u,h as f,w as y,n as i,j as S,V as ee,o,f as m,c as J,F as v,$ as K,ac as se,u as oe,r as B,k as ne,i as te,q as ie,v as xe,g as de,ab as Se}from"./index-8e4e81f1.js";import{m as le,s as _e}from"./sharedFunctions-35bb9dec.js";import{V as Re}from"./VInput-cf82db51.js";import{V as Ve}from"./VCheckbox-6ba6afcd.js";import{b as we,w as Ce,m as Ee,d as Ue,e as Me,g as je,h as Fe,u as Ye,p as Ne,i as Ae,x as Qe,k as Ge,l as ze,n as He,o as Le,r as ue,s as ke,t as ce,y as Je}from"./VDataTable-4f24c634.js";import{b as Ke,c as qe,d as We}from"./VSelect-32de11b2.js";import{V as ye}from"./VTooltip-5cdbd8b8.js";import{_ as Xe}from"./_plugin-vue_export-helper-c27b6911.js";import"./_commonjsHelpers-de833af9.js";import"./VCheckboxBtn-bcfc7d4b.js";import"./VDivider-fd7c1266.js";import"./VTextField-01778494.js";import"./VImg-afe548b3.js";import"./VList-9b82c2cd.js";import"./VAvatar-a002db8e.js";import"./dialog-transition-d4838f6c.js";import"./VMenu-c4bd5c34.js";import"./VChip-92e480f5.js";const Ze=Ie({...we(),...Ce(),...Ke(),...Ee()},"VDataTableVirtual"),$e=Te()({name:"VDataTableVirtual",props:Ze(),emits:{"update:modelValue":s=>!0,"update:sortBy":s=>!0,"update:options":s=>!0,"update:groupBy":s=>!0,"update:expanded":s=>!0},setup(s,d){let{attrs:h,slots:e}=d;const{groupBy:D}=Ue(s),{sortBy:P,multiSort:r,mustSort:p}=Me(s),{columns:n,headers:x,sortFunctions:k,filterFunctions:t}=je(s,{groupBy:D,showSelect:w(s,"showSelect"),showExpand:w(s,"showExpand")}),{items:C}=Fe(s,n),M=w(s,"search"),{filteredItems:F}=Ye(s,C,M,{transform:V=>V.columns,customKeyFilter:t}),{toggleSort:Y}=Ne({sortBy:P,multiSort:r,mustSort:p}),{sortByWithGroups:N,opened:q,extractRows:j,isGroupOpen:A,toggleGroup:Q}=Ae({groupBy:D,sortBy:P}),{sortedItems:G}=Qe(s,F,N,k),{flatItems:_}=Ge(G,D,q),R=Z(()=>j(_.value)),{isSelected:W,select:z,selectAll:g,toggleSelect:l,someSelected:c,allSelected:a}=ze(s,{allItems:R,currentPage:R}),{isExpanded:b,toggleExpand:E}=He(s),{containerRef:I,markerRef:T,paddingTop:me,paddingBottom:Oe,computedItems:ge,handleItemResize:fe,handleScroll:pe,handleScrollend:Be}=qe(s,_),ve=Z(()=>ge.value.map(V=>V.raw));Le({sortBy:P,page:ae(1),itemsPerPage:ae(-1),groupBy:D,search:M}),he({VDataTableRows:{hideNoData:w(s,"hideNoData"),noDataText:w(s,"noDataText"),loading:w(s,"loading"),loadingText:w(s,"loadingText")}});const H=Z(()=>({sortBy:P.value,toggleSort:Y,someSelected:c.value,allSelected:a.value,isSelected:W,select:z,selectAll:g,toggleSelect:l,isExpanded:b,toggleExpand:E,isGroupOpen:A,toggleGroup:Q,items:R.value.map(V=>V.raw),internalItems:R.value,groupedItems:_.value,columns:n.value,headers:x.value}));Pe(()=>{const V=ue.filterProps(s),be=ke.filterProps(s),De=ce.filterProps(s);return O(ce,L({class:["v-data-table",{"v-data-table--loading":s.loading},s.class],style:s.style},De),{top:()=>e.top?.(H.value),wrapper:()=>O("div",{ref:I,onScrollPassive:pe,onScrollend:Be,class:"v-table__wrapper",style:{height:$(s.height)}},[O("table",null,[O("thead",null,[O(ue,L(V,{sticky:s.fixedHeader}),e)]),O("tbody",null,[O("tr",{ref:T,style:{height:$(me.value),border:0}},[O("td",{colspan:n.value.length,style:{height:0,border:0}},null)]),e["body.prepend"]?.(H.value),O(ke,L(h,be,{items:ve.value}),{...e,item:U=>O(We,{key:U.internalItem.index,renderless:!0,"onUpdate:height":X=>fe(U.internalItem.index,X)},{default:X=>{let{itemRef:re}=X;return e.item?.({...U,itemRef:re})??O(Je,L(U.props,{ref:re,key:U.internalItem.index,index:U.internalItem.index}),e)}})}),e["body.append"]?.(H.value),O("tr",{style:{height:$(Oe.value),border:0}},[O("td",{colspan:n.value.length,style:{height:0,border:0}},null)])])])]),bottom:()=>e.bottom?.(H.value)})})}}),et={class:"ditto-order-table"},tt={class:"d-flex align-center flex-wrap gap-4 justify-space-between px-4 py-4"},rt={class:"d-flex align-center flex-wrap gap-4"},at={key:0},st={class:"custom-capitalize"},ot={class:"cursor-pointer"},nt={key:0,class:"child-order-row-bg-color"},it={key:0},dt={key:2,class:"custom-capitalize"},lt={key:4,class:"cursor-pointer"},ut={key:1,class:"text-primary"},kt={key:0},ct={key:2,class:"custom-capitalize"};function yt(s,d,h,e,D,P){return o(),u("div",et,[f("section",null,[f("div",tt,[f("div",rt,[O(Re,null,{default:y(()=>d[3]||(d[3]=[m("Parent Broker:")])),_:1}),e.parentDetails?(o(),u("b",at,i(e.parentDetails?.stBrokerName+" - ")+" "+i(e.parentDetails?.stBrokerUserId?e.sharedFunctions.formatBrokerUserId(e.parentDetails.stBrokerUserId):""),1)):S("",!0),O(Ve,{modelValue:e.isRejetOrderOnly,"onUpdate:modelValue":[d[0]||(d[0]=r=>e.isRejetOrderOnly=r),e.setDittoOrderDetails],label:"Show Rejected/Error Orders Only"},null,8,["modelValue"])]),O(ee,{class:"custom-flex-sm-50 custom-flex-xs-50",variant:"outlined",onClick:d[1]||(d[1]=r=>e.getDittoOrdersDetails())},{default:y(()=>d[4]||(d[4]=[m(" Refresh ")])),_:1})]),O($e,{expanded:e.expanded,"onUpdate:expanded":d[2]||(d[2]=r=>e.expanded=r),headers:e.cols,items:e.currentDittoOrder,"item-value":"key","show-expand":"",loading:e.loading,density:"compact"},{"item.stSymbolName":y(({item:r})=>[f("b",null,i(e.parentOrderBook?.[r.key]?.stSymbolName),1)]),"item.stOrderType":y(({item:r})=>[f("b",null,i(e.parentOrderBook?.[r.key]?.stOrderType),1)]),"item.stTransactionType":y(({item:r})=>[f("b",null,i(e.parentOrderBook?.[r.key]?.stTransactionType),1)]),"item.inQuantity":y(({item:r})=>[f("b",null,i(e.parentOrderBook?.[r.key]?.inRemainingQuantity+"/"+e.parentOrderBook?.[r.key]?.inQuantity),1)]),"item.inOrderPrice":y(({item:r})=>[f("b",null,i(e.parentOrderBook?.[r.key]?.inOrderPrice),1)]),"item.inTradedPrice":y(({item:r})=>[f("b",null,i(e.parentOrderBook?.[r.key]?.inTradedPrice),1)]),"item.inTriggerPrice":y(({item:r})=>[f("b",null,i(e.parentOrderBook?.[r.key]?.inTriggerPrice),1)]),"item.stBrokerStatus":y(({item:r})=>[f("b",st,i(e.parentOrderBook?.[r.key]?.stBrokerStatus),1)]),"item.stFetchDate":y(({item:r})=>[f("b",null,[m(i(e.parentOrderBook?.[r.key]?.stFetchTime)+" ",1),d[5]||(d[5]=f("br",null,null,-1)),m(" "+i(e.moment(e.parentOrderBook?.[r.key]?.stFetchDate,"YYYY-MM-DD",!0).format("DD-MM-YYYY")),1)])]),"item.stOrderId":y(({item:r})=>[f("b",null,i(e.parentOrderBook?.[r.key]?.stOrderId),1)]),"item.stMessage":y(({item:r})=>[f("u",ot,[e.parentOrderBook?.[r.key]?.stMessage?(o(),J(ye,{key:0,activator:"parent",location:"top"},{default:y(()=>[m(i(e.parentOrderBook?.[r.key]?.stMessage),1)]),_:2},1024)):S("",!0),d[6]||(d[6]=m(" info "))])]),"expanded-row":y(({columns:r,item:p})=>[(o(!0),u(v,null,K(e.childDetails,(n,x)=>(o(),u(v,null,[e.dittoOrdersMathing?.[e.parentOrderBook?.[p.key]?.stOrderId]?.[n?.inUserBrokerId]?(o(!0),u(v,{key:0},K(e.dittoOrdersMathing[e.parentOrderBook[p.key].stOrderId][n.inUserBrokerId],k=>(o(),u(v,null,[k.stChildOrderId?(o(),u("tr",nt,[(o(!0),u(v,null,K(r,t=>(o(),u("td",{class:se(`${t.key=="stOrderType"||t.key=="stTransactionType"||t.key=="inQuantity"||t.key=="inOrderPrice"||t.key=="inTradedPrice"||t.key=="inTriggerPrice"?"text-center":""}`)},[t.key=="stSymbolName"?(o(),u("b",it," Child "+i(x+1)+" : "+i(n.stBrokerName+" - ")+" "+i(n?.stBrokerUserId?e.sharedFunctions.formatBrokerUserId(n.stBrokerUserId)+" ":""),1)):S("",!0),t.key=="Action"?(o(),u(v,{key:1},[k.stValidOrderStatus!="ERROR_OR_REJECTED_ORDER"&&e.childOrderBook?.[n?.inUserBrokerId]?.[k?.stChildOrderId]?.stBrokerStatus=="rejected"&&e.parentOrderBook[p.key].stBrokerStatus!="rejected"&&e.parentOrderBook[p.key].stBrokerStatus!="cancelled"?(o(),J(ee,{key:0,density:"compact",onClick:C=>e.placeRejectedErrorOrderAgain(k.inUserDittoOrderId)},{default:y(()=>d[7]||(d[7]=[m(" Place again ")])),_:2},1032,["onClick"])):S("",!0)],64)):t.key=="stBrokerStatus"?(o(),u("span",dt,i(e.childOrderBook[n.inUserBrokerId][k.stChildOrderId][t.key]),1)):t.key=="inQuantity"?(o(),u(v,{key:3},[m(i(e.childOrderBook[n.inUserBrokerId][k.stChildOrderId].inRemainingQuantity+"/"+e.childOrderBook[n.inUserBrokerId][k.stChildOrderId][t.key]),1)],64)):t.key=="stMessage"?(o(),u("u",lt,[e.childOrderBook[n.inUserBrokerId][k.stChildOrderId][t.key]?(o(),J(ye,{key:0,activator:"parent",location:"top"},{default:y(()=>[m(i(e.childOrderBook[n.inUserBrokerId][k.stChildOrderId][t.key]),1)]),_:2},1024)):S("",!0),d[8]||(d[8]=m(" info "))])):t.key=="stFetchDate"?(o(),u(v,{key:5},[m(i(e.childOrderBook[n.inUserBrokerId][k.stChildOrderId].stFetchTime)+" ",1),d[9]||(d[9]=f("br",null,null,-1)),m(" "+i(e.moment(e.childOrderBook[n.inUserBrokerId][k.stChildOrderId][t.key],"YYYY-MM-DD",!0).format("DD-MM-YYYY")),1)],64)):(o(),u(v,{key:6},[m(i(e.childOrderBook[n.inUserBrokerId][k.stChildOrderId][t.key]),1)],64))],2))),256))])):(o(),u("tr",ut,[(o(!0),u(v,null,K(r,t=>(o(),u("td",{class:se(`${t.key=="stOrderType"||t.key=="stTransactionType"||t.key=="inQuantity"||t.key=="inOrderPrice"||t.key=="inTradedPrice"||t.key=="inTriggerPrice"?"text-center":""}`)},[t.key=="stSymbolName"?(o(),u("b",kt,i(n.stBrokerName+" - "+n.stBrokerUserId+" "),1)):S("",!0),t.key=="stOrderId"||t.key=="inQuantity"||t.key=="inOrderPrice"||t.key=="inTradedPrice"||t.key=="inTriggerPrice"?(o(),u(v,{key:1},[m(" - ")],64)):t.key=="stBrokerStatus"?(o(),u("span",ct,i(k.stBrokerStatus),1)):t.key=="stTransactionType"?(o(),u(v,{key:3},[m(i(k.stTransactionType),1)],64)):t.key=="Action"?(o(),u(v,{key:4},[k.stValidOrderStatus!="ERROR_OR_REJECTED_ORDER"&&e.parentOrderBook[p.key].stBrokerStatus!="rejected"&&e.parentOrderBook[p.key].stBrokerStatus!="cancelled"?(o(),J(ee,{key:0,density:"compact",onClick:C=>e.placeRejectedErrorOrderAgain(k.inUserDittoOrderId)},{default:y(()=>d[10]||(d[10]=[m(" Place again ")])),_:2},1032,["onClick"])):S("",!0)],64)):(o(),u(v,{key:5},[m(i(e.parentOrderBook?.[p.key]?.[t.key]),1)],64))],2))),256))]))],64))),256)):S("",!0)],64))),256))]),_:1},8,["expanded","headers","items","loading"])])])}const mt={__name:"Orders",setup(s,{expose:d}){d(),le.tz.setDefault("Asia/Kolkata");const h=oe(),e=ie(),D=B(!1),P=B([]),r=B([]),p=B({}),n=B({}),x=B({}),k=B({}),t=B([]),C=B({}),M=B(null),F=B(null),Y=B(!1),N=B([]),q=B([{title:"Symbol Name",key:"stSymbolName",sortable:!1},{title:"Type",key:"stOrderType",sortable:!1,align:"center"},{title:"Side",key:"stTransactionType",sortable:!1,align:"center"},{title:"Rem Qty/Qty",key:"inQuantity",sortable:!1,align:"center"},{title:"Order Price",key:"inOrderPrice",sortable:!1,align:"center"},{title:"Traded Price",key:"inTradedPrice",sortable:!1,align:"center"},{title:"Trigger Price",key:"inTriggerPrice",sortable:!1,align:"center"},{title:"Status",key:"stBrokerStatus",sortable:!1},{title:"Time/Date",key:"stFetchDate",width:"115px",sortable:!1},{title:"Order Id",key:"stOrderId",sortable:!1},{title:"Message",key:"stMessage",sortable:!1},{title:"Action",key:"Action",sortable:!1}]);ne(()=>{j()});const j=async g=>{D.value=!0;const l={};te.post("/ditto/getdittoordersdetails",l).then(async c=>{const a=c.data;if(a.status=="success"){p.value={},n.value={},M.value=a.data.parentDetails,F.value=a.data.childDetails,r.value=a.data.dittoOrders;const b=await A(a.data.dittoOrders);x.value=b.dittoOrdersMatchingDetails,k.value=b.dittoChildOrderExist;const E=G(a.data.parentDetails),I=Q(a.data.childDetails),T=await Promise.all([E,I]);T[0]&&(t.value=T[0]),T[1]&&(C.value=T[1]),R(),D.value=!1}else D.value=!1,h.toastMessage({color:a.status,message:a.msg})}).catch(c=>{console.log("err :>> ",c),D.value=!1}).finally(()=>{})};async function A(g){let l={},c={};return g.forEach((a,b)=>{c[a.stChildOrderId]=b,a.stBrokerStatus=="error"&&(n.value[a.stParentOrderId]=!0),l[a.stParentOrderId]||(l[a.stParentOrderId]={}),l[a.stParentOrderId]={...l[a.stParentOrderId],[a.inChildUserBrokerId]:[...l[a.stParentOrderId][a.inChildUserBrokerId]||[],a]}}),Object.keys(n.value).forEach(a=>{p.value[a]=l[a]}),{dittoOrdersMatchingDetails:l,dittoChildOrderExist:c}}async function Q(g){let l={};for await(const[c,a]of Object.entries(g)){const b=await _(a.stIdentificationToken);if(b){let E={};b.forEach(I=>{if((I.stBrokerStatus=="rejected"||I.stBrokerStatus=="error")&&k.value[I.stOrderId]!=null){const T=r.value[k.value[I.stOrderId]];n.value[T.stParentOrderId]||(p.value[T.stParentOrderId]=x.value[T.stParentOrderId])}E[I.stOrderId]=I}),l[a.inUserBrokerId]=E}}return l}async function G(g){let l={};const c=await _(g.stIdentificationToken);let a={};return c.forEach(b=>{a[b.stOrderId]=b}),l=a,l}async function _(g){return await h.getOrderBook(g).then(l=>l.status=="success"?l.data:(h.toastMessage({color:l.status,message:l.msg}),null)).catch(l=>{})}function R(){Y.value?P.value=Object.keys(p.value).map(g=>({key:g})):P.value=Object.keys(x.value).map(g=>({key:g})),N.value=Object.keys(n.value)}function W(g){const l={inUserDittoOrderId:g};te.post(de.orderApiUrl+"/order/v2/place-rejected-error-order-again",l).then(c=>{c.data.status=="success"?(h.toastMessage({color:c.data.status,message:c.data.msg}),j()):h.toastMessage({color:c.data.status,message:c.data.msg})}).catch(c=>{})}const z={store:h,router:e,loading:D,currentDittoOrder:P,dittoOrders:r,dittoRejectOrderBook:p,dittoRejectParentOrderId:n,dittoOrdersMathing:x,dittoChildOrderExist:k,parentOrderBook:t,childOrderBook:C,parentDetails:M,childDetails:F,isRejetOrderOnly:Y,expanded:N,cols:q,getDittoOrdersDetails:j,childOrderMatching:A,getChildOrderBook:Q,getParentOrderBook:G,getOrderBook:_,setDittoOrderDetails:R,placeRejectedErrorOrderAgain:W,ref:B,onMounted:ne,watch:xe,get axios(){return te},get useAppStore(){return oe},get config(){return de},get useRouter(){return ie},get sharedFunctions(){return _e},get get(){return Se},get moment(){return le}};return Object.defineProperty(z,"__isScriptSetup",{enumerable:!1,value:!0}),z}},Ct=Xe(mt,[["render",yt]]);export{Ct as default};
